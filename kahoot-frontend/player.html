<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jugador</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #game, #questionContainer { display: none; margin-top: 20px; }
    .option-btn { display: block; margin: 8px 0; padding: 10px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; }
    .correct { background-color: #c8e6c9; }
    .incorrect { background-color: #ffcdd2; }
  </style>
</head>
<body>

  <h1>Bienvenido, Jugador</h1>

  <div id="join">
    <input type="text" id="nameInput" placeholder="Tu nombre" />
    <select id="roleSelect">
      <option value="">Selecciona tu rol</option>
      <option value="marketing">Marketing</option>
      <option value="comunicaciones">Comunicaciones</option>
      <option value="seguridad">Seguridad</option>
    </select>
    <button id="joinBtn">Unirse al juego</button>
  </div>

  <div id="waiting">Esperando a que el administrador inicie el juego...</div>

  <div id="game">
    <h2 id="scenarioName"></h2>
    <p id="scenarioDescription"></p>
    <div id="questionContainer">
      <h3 id="questionText"></h3>
      <div id="optionsContainer"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const nameInput = document.getElementById('nameInput');
    const roleSelect = document.getElementById('roleSelect');
    const joinBtn = document.getElementById('joinBtn');
    const waiting = document.getElementById('waiting');
    const game = document.getElementById('game');
    const scenarioName = document.getElementById('scenarioName');
    const scenarioDescription = document.getElementById('scenarioDescription');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const questionContainer = document.getElementById('questionContainer');

    let playerRole = '';
    let currentQuestionIndex = 0;

    joinBtn.onclick = () => {
      const name = nameInput.value.trim();
      playerRole = roleSelect.value;

      if (!name || !playerRole) {
        alert("Ingresa tu nombre y selecciona un rol.");
        return;
      }

      socket.emit('joinGame', { name, role: playerRole, isAdmin: false });
      document.getElementById('join').style.display = 'none';
      waiting.style.display = 'block';
    };

    socket.on('waitingForGameToStart', () => {
      waiting.style.display = 'block';
    });

    socket.on('gameStarted', ({ scenarioName: sName, scenarioDescription: sDesc }) => {
      waiting.style.display = 'none';
      game.style.display = 'block';
      scenarioName.textContent = sName;
      scenarioDescription.textContent = sDesc;

      // Avisamos al servidor que el jugador está listo para recibir preguntas
      socket.emit('playerReadyForQuestions');
    });

    socket.on('receiveQuestion', (question) => {
      if (!question || !question.text) return;

      questionContainer.style.display = 'block';
      questionText.textContent = question.text;
      optionsContainer.innerHTML = '';

      question.options.forEach(option => {
        const btn = document.createElement('button');
        btn.classList.add('option-btn');
        btn.textContent = option;
        btn.onclick = () => {
          const isCorrect = option === question.correctAnswer;
          btn.classList.add(isCorrect ? 'correct' : 'incorrect');

          setTimeout(() => {
            socket.emit('playerReadyForQuestions');
          }, 1000);
        };
        optionsContainer.appendChild(btn);
      });
    });

    socket.on('noMoreQuestions', () => {
      questionText.textContent = '¡Has respondido todas las preguntas!';
      optionsContainer.innerHTML = '';
    });

    socket.on('error', (msg) => {
      alert("Error: " + msg);
    });
  </script>
</body>
</html>
